<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/sles4sap/azure_cli.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel='stylesheet' href='../style.css' />
</head>

<body>



<ul id="index"><li><a href="../index.html"><i>&lt;= Back to file list</i></a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a>
    <ul>
      <li><a href="#az_version">az_version</a></li>
      <li><a href="#az_group_create">az_group_create</a></li>
      <li><a href="#az_group_name_get">az_group_name_get</a></li>
      <li><a href="#az_network_vnet_create">az_network_vnet_create</a></li>
      <li><a href="#az_network_nsg_create">az_network_nsg_create</a></li>
      <li><a href="#az_network_nsg_rule_create">az_network_nsg_rule_create</a></li>
      <li><a href="#az_network_publicip_create">az_network_publicip_create</a></li>
      <li><a href="#az_network_publicip_get">az_network_publicip_get</a></li>
      <li><a href="#az_network_lb_create">az_network_lb_create</a></li>
      <li><a href="#az_network_lb_probe_create">az_network_lb_probe_create</a></li>
      <li><a href="#az_network_lb_rule_create">az_network_lb_rule_create</a></li>
      <li><a href="#az_vm_as_create">az_vm_as_create</a></li>
      <li><a href="#az_vm_create">az_vm_create</a></li>
      <li><a href="#az_vm_openport">az_vm_openport</a></li>
      <li><a href="#az_vm_wait_cloudinit">az_vm_wait_cloudinit</a></li>
      <li><a href="#az_nic_id_get">az_nic_id_get</a></li>
      <li><a href="#az_nic_get">az_nic_get</a></li>
      <li><a href="#az_nic_name_get">az_nic_name_get</a></li>
      <li><a href="#az_ipconfig_name_get">az_ipconfig_name_get</a></li>
      <li><a href="#az_ipconfig_update">az_ipconfig_update</a></li>
      <li><a href="#az_ipconfig_pool_add">az_ipconfig_pool_add</a></li>
    </ul>
  </li>
</ul><h1>lib/sles4sap/azure_cli.pm</h1>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Library to compose and run Azure cli commands</p>

<h2 id="az_version">az_version</h2>

<pre><code>az_version();</code></pre>

<p>Print the version of the az cli available on system</p>

<h2 id="az_group_create">az_group_create</h2>

<pre><code>az_group_create( name =&gt; &#39;openqa-rg&#39;, region =&gt; &#39;westeurope&#39;);</code></pre>

<p>Create an Azure resource group in a specific region</p>

<dl>

<dt id="name---full-name-of-the-resource-group"><b>name</b> - full name of the resource group</dt>
<dd>

</dd>
<dt id="region---Azure-region"><b>region</b> - Azure region</dt>
<dd>

</dd>
</dl>

<h2 id="az_group_name_get">az_group_name_get</h2>

<pre><code>az_group_name_get();</code></pre>

<p>Get the name of all existing Resource groups in the current subscription</p>

<h2 id="az_network_vnet_create">az_network_vnet_create</h2>

<pre><code>az_network_vnet_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    region =&gt; &#39;westeurope&#39;,
    vnet =&gt; &#39;openqa-vnet&#39;,
    snet =&gt; &#39;openqa-subnet&#39;,
    address_prefixes =&gt; &#39;10.0.1.0/16&#39;,
    subnet_prefixes =&gt; &#39;10.0.1.0/24&#39;)</code></pre>

<p>Create a virtual network</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-the-network"><b>resource_group</b> - existing resource group where to create the network</dt>
<dd>

</dd>
<dt id="region---Azure-region1"><b>region</b> - Azure region</dt>
<dd>

</dd>
<dt id="vnet---name-of-the-virtual-network"><b>vnet</b> - name of the virtual network</dt>
<dd>

</dd>
<dt id="snet---name-of-the-subnet"><b>snet</b> - name of the subnet</dt>
<dd>

</dd>
<dt id="address_prefixes---virtual-network-ip-address-space.-Default-192.168.0.0-16"><b>address_prefixes</b> - virtual network ip address space. Default 192.168.0.0/16</dt>
<dd>

</dd>
<dt id="subnet_prefixes---subnet-ip-address-space.-Default-192.168.0.0-24"><b>subnet_prefixes</b> - subnet ip address space. Default 192.168.0.0/24</dt>
<dd>

</dd>
</dl>

<h2 id="az_network_nsg_create">az_network_nsg_create</h2>

<pre><code>az_network_nsg_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-nsg&#39;)</code></pre>

<p>Create a network security group</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-the-NSG"><b>resource_group</b> - existing resource group where to create the NSG</dt>
<dd>

</dd>
<dt id="name---security-group-name"><b>name</b> - security group name</dt>
<dd>

</dd>
</dl>

<h2 id="az_network_nsg_rule_create">az_network_nsg_rule_create</h2>

<pre><code>az_network_nsg_rule_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    nsg =&gt; &#39;openqa-nsg&#39;,
    name =&gt; &#39;openqa-nsg-rule-ssh&#39;,
    port =&gt; 22)</code></pre>

<p>Create a very specific type of inbound rule for an existing network security group Just few parameters are configurable here, like the port number</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-the-NSG1"><b>resource_group</b> - existing resource group where to create the NSG</dt>
<dd>

</dd>
<dt id="nsg---existing-security-group-name"><b>nsg</b> - existing security group name</dt>
<dd>

</dd>
<dt id="name---security-rule-name"><b>name</b> - security rule name</dt>
<dd>

</dd>
<dt id="port---allowed-port"><b>port</b> - allowed port</dt>
<dd>

</dd>
</dl>

<h2 id="az_network_publicip_create">az_network_publicip_create</h2>

<pre><code>az_network_publicip_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-pip&#39;,
    zone =&gt; &#39;1 2 3&#39;)</code></pre>

<p>Create an IPv4 public IP resource</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-the-PubIP"><b>resource_group</b> - existing resource group where to create the PubIP</dt>
<dd>

</dd>
<dt id="name---public-IP-resource-name"><b>name</b> - public IP resource name</dt>
<dd>

</dd>
<dt id="sku---default-Standard"><b>sku</b> - default Standard</dt>
<dd>

</dd>
<dt id="allocation_method---optionally-add---allocation-method"><b>allocation_method</b> - optionally add --allocation-method</dt>
<dd>

</dd>
<dt id="zone---optionally-add---zone"><b>zone</b> - optionally add --zone</dt>
<dd>

</dd>
</dl>

<h2 id="az_network_publicip_get">az_network_publicip_get</h2>

<pre><code>az_network_publicip_get(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-pip&#39;)</code></pre>

<p>Return an IPv4 public IP address from its name</p>

<dl>

<dt id="resource_group---existing-resource-group-including-the-PubIP"><b>resource_group</b> - existing resource group including the PubIP</dt>
<dd>

</dd>
<dt id="name---existing-public-IP-resource-name"><b>name</b> - existing public IP resource name</dt>
<dd>

</dd>
</dl>

<h2 id="az_network_lb_create">az_network_lb_create</h2>

<pre><code>az_network_lb_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-lb&#39;,
    vnet =&gt; &#39;openqa-vnet&#39;,
    snet =&gt; &#39;openqa-subnet&#39;,
    backend =&gt; &#39;openqa-be&#39;,
    frontend_ip =&gt; &#39;openqa-feip&#39;,
    sku =&gt; &#39;Standard&#39;)</code></pre>

<p>Create a load balancer entity. LB is mostly &quot;just&quot; a &quot;group&quot; definition to link back-end and front-end resources (usually an IP)</p>

<p>SKU Standard (and not Basic) is needed to get some Metrics</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-lb"><b>resource_group</b> - existing resource group where to create lb</dt>
<dd>

</dd>
<dt id="name---load-balancer-name"><b>name</b> - load balancer name</dt>
<dd>

</dd>
<dt id="vnet---existing-Virtual-network-name-where-to-create-LB-in"><b>vnet</b> - existing Virtual network name where to create LB in</dt>
<dd>

</dd>
<dt id="snet---existing-Subnet-network-name-where-to-create-LB-in"><b>snet</b> - existing Subnet network name where to create LB in</dt>
<dd>

</dd>
<dt id="backend---name-to-assign-to-created-backend-pool"><b>backend</b> - name to assign to created backend pool</dt>
<dd>

</dd>
<dt id="frontend_ip---name-to-assign-to-created-frontend-ip-will-be-reused-in-az-network-lb-rule-create"><b>frontend_ip</b> - name to assign to created frontend ip, will be reused in &quot;az network lb rule create&quot;</dt>
<dd>

</dd>
<dt id="sku---default-Basic"><b>sku</b> - default Basic</dt>
<dd>

</dd>
<dt id="fip---optionally-add---private-ip-address"><b>fip</b> - optionally add --private-ip-address</dt>
<dd>

</dd>
</dl>

<h2 id="az_network_lb_probe_create">az_network_lb_probe_create</h2>

<pre><code>az_network_lb_probe_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    lb_name =&gt; &#39;openqa-lb&#39;,
    name =&gt; &#39;openqa-lb-hp&#39;,
    port =&gt; &#39;4242&#39;,
    protocol =&gt; &#39;Udp&#39;,
    )</code></pre>

<p>Create a load balancer health probe.</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-lb1"><b>resource_group</b> - existing resource group where to create lb</dt>
<dd>

</dd>
<dt id="lb_name---existing-load-balancer-name"><b>lb_name</b> - existing load balancer name</dt>
<dd>

</dd>
<dt id="name---name-for-the-new-health-probe"><b>name</b> - name for the new health probe</dt>
<dd>

</dd>
<dt id="port---port-number-monitored-by-the-health-probe"><b>port</b> - port number monitored by the health probe</dt>
<dd>

</dd>
<dt id="protocol---protocol-for-the-health-probe.-Default-Tcp"><b>protocol</b> - protocol for the health probe. Default Tcp</dt>
<dd>

</dd>
</dl>

<h2 id="az_network_lb_rule_create">az_network_lb_rule_create</h2>

<pre><code>az_network_lb_rule_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    lb_name =&gt; &#39;openqa-lb&#39;,
    hp_name =&gt; &#39;openqa-hb&#39;,
    frontend_ip =&gt; &#39;openqa-fe&#39;,
    backend =&gt; &#39;openqa-be&#39;,
    name =&gt; &#39;openqa-lb-rule&#39;,
    port =&gt; &#39;80&#39;
    )</code></pre>

<p>Configure the load balancer behavior.</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-lb2"><b>resource_group</b> - existing resource group where to create lb</dt>
<dd>

</dd>
<dt id="lb_name---existing-load-balancer-name1"><b>lb_name</b> - existing load balancer name</dt>
<dd>

</dd>
<dt id="hp_name---existing-load-balancer-health-probe-name"><b>hp_name</b> - existing load balancer health probe name</dt>
<dd>

</dd>
<dt id="frontend_ip---existing-load-balancer-front-end-IP-name"><b>frontend_ip</b> - existing load balancer front end IP name</dt>
<dd>

</dd>
<dt id="backend---existing-load-balancer-back-end-pool-name"><b>backend</b> - existing load balancer back end pool name</dt>
<dd>

</dd>
<dt id="name---name-for-the-new-load-balancer-rule"><b>name</b> - name for the new load balancer rule</dt>
<dd>

</dd>
<dt id="port---port-mapped-between-the-frontend-and-the-backend.-This-poor-Perl-wrapper-map-them-1:1"><b>port</b> - port mapped between the frontend and the backend. This poor Perl wrapper map them 1:1</dt>
<dd>

</dd>
<dt id="protocol---protocol-for-the-load-balancer-rule.-Default-Tcp"><b>protocol</b> - protocol for the load balancer rule. Default Tcp</dt>
<dd>

</dd>
</dl>

<h2 id="az_vm_as_create">az_vm_as_create</h2>

<pre><code>az_vm_as_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-as&#39;,
    region =&gt; &#39;westeurope&#39;,
    fault_count =&gt; 2)</code></pre>

<p>Create an availability set. Later on VM can be assigned to it.</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-the-Availability-set"><b>resource_group</b> - existing resource group where to create the Availability set</dt>
<dd>

</dd>
<dt id="region---region-where-to-create-the-Availability-set"><b>region</b> - region where to create the Availability set</dt>
<dd>

</dd>
<dt id="name---availability-set-name"><b>name</b> - availability set name</dt>
<dd>

</dd>
<dt id="fault_count---value-for---platform-fault-domain-count"><b>fault_count</b> - value for --platform-fault-domain-count</dt>
<dd>

</dd>
</dl>

<h2 id="az_vm_create">az_vm_create</h2>

<pre><code>az_vm_create(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-vm&#39;,
    region =&gt; &#39;westeurope&#39;,
    image =&gt; &#39;SUSE:sles-sap-15-sp5:gen2:latest&#39;)</code></pre>

<p>Create a virtual machine</p>

<dl>

<dt id="name---virtual-machine-name"><b>name</b> - virtual machine name</dt>
<dd>

</dd>
<dt id="resource_group---existing-resource-group-where-to-create-the-VM"><b>resource_group</b> - existing resource group where to create the VM</dt>
<dd>

</dd>
<dt id="image---OS-image-name"><b>image</b> - OS image name</dt>
<dd>

</dd>
<dt id="vnet---optional-name-of-the-Virtual-Network-where-to-place-the-VM"><b>vnet</b> - optional name of the Virtual Network where to place the VM</dt>
<dd>

</dd>
<dt id="snet---optional-name-of-the-SubNet-where-to-connect-the-VM"><b>snet</b> - optional name of the SubNet where to connect the VM</dt>
<dd>

</dd>
<dt id="size---VM-size-default-Standard_B1s"><b>size</b> - VM size, default Standard_B1s</dt>
<dd>

</dd>
<dt id="region---optional-region-where-to-create-the-VM"><b>region</b> - optional region where to create the VM</dt>
<dd>

</dd>
<dt id="availability_set---optional-inclusion-in-an-availability-set"><b>availability_set</b> - optional inclusion in an availability set</dt>
<dd>

</dd>
<dt id="username---optional-admin-username"><b>username</b> - optional admin username</dt>
<dd>

</dd>
<dt id="nsg---optional-inclusion-in-an-network-security-group"><b>nsg</b> - optional inclusion in an network security group</dt>
<dd>

</dd>
<dt id="nic---optional-add-to-the-VM-a-NIC-created-separately-with-az-network-nic-create"><b>nic</b> - optional add to the VM a NIC created separately with &#39;az network nic create&#39;</dt>
<dd>

</dd>
<dt id="public_ip---optional-add-to-the-VM-a-public-IP.-Value-like-is-a-valid-one-and-is-not-the-same-as-not-including-the-argument-at-all"><b>public_ip</b> - optional add to the VM a public IP. Value like &quot;&quot; is a valid one and is not the same as not including the argument at all.</dt>
<dd>

</dd>
<dt id="custom_data---optional-provide-a-cloud-init-script-file"><b>custom_data</b> - optional provide a cloud-init script file</dt>
<dd>

</dd>
<dt id="ssh_pubkey---optional-inclusion-in-an-availability-set-if-missing-the-command-is-configured-to-generate-one"><b>ssh_pubkey</b> - optional inclusion in an availability set, if missing the command is configured to generate one</dt>
<dd>

</dd>
</dl>

<h2 id="az_vm_openport">az_vm_openport</h2>

<pre><code>az_vm_openport(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-vm&#39;,
    port =&gt; 80)</code></pre>

<p>Open a port on an existing VM</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-the-Availability-set1"><b>resource_group</b> - existing resource group where to create the Availability set</dt>
<dd>

</dd>
<dt id="name---name-of-an-existing-VM"><b>name</b> - name of an existing VM</dt>
<dd>

</dd>
<dt id="port---port-to-open"><b>port</b> - port to open</dt>
<dd>

</dd>
</dl>

<h2 id="az_vm_wait_cloudinit">az_vm_wait_cloudinit</h2>

<pre><code>az_vm_wait_cloudinit(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-vm&#39;)</code></pre>

<p>Wait cloud-init completion on a running VM</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-the-Availability-set2"><b>resource_group</b> - existing resource group where to create the Availability set</dt>
<dd>

</dd>
<dt id="name---name-of-an-existing-VM1"><b>name</b> - name of an existing VM</dt>
<dd>

</dd>
<dt id="username---username-default-cloudadmin"><b>username</b> - username default cloudadmin</dt>
<dd>

</dd>
<dt id="timeout---max-wait-time-in-seconds.-Default-3600"><b>timeout</b> - max wait time in seconds. Default 3600.</dt>
<dd>

</dd>
</dl>

<h2 id="az_nic_id_get">az_nic_id_get</h2>

<pre><code>my $nic_id = az_nic_id_get(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-vm&#39;)</code></pre>

<p>Get the NIC ID of the first NIC of a given VM</p>

<dl>

<dt id="resource_group---existing-resource-group-where-to-create-the-Availability-set3"><b>resource_group</b> - existing resource group where to create the Availability set</dt>
<dd>

</dd>
<dt id="name---name-of-an-existing-VM2"><b>name</b> - name of an existing VM</dt>
<dd>

</dd>
</dl>

<h2 id="az_nic_get">az_nic_get</h2>

<p>Get the NIC data from NIC ID</p>

<dl>

<dt id="nic_id---existing-NIC-ID-eg.-from-az_nic_id_get"><b>nic_id</b> - existing NIC ID (eg. from az_nic_id_get)</dt>
<dd>

</dd>
<dt id="filter---query-filter"><b>filter</b> - query filter</dt>
<dd>

</dd>
</dl>

<h2 id="az_nic_name_get">az_nic_name_get</h2>

<pre><code>my $nic_name = az_nic_name_get(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-vm&#39;)</code></pre>

<p>Get the NIC name from NIC ID</p>

<dl>

<dt id="nic_id---existing-NIC-ID-eg.-from-az_nic_id_get1"><b>nic_id</b> - existing NIC ID (eg. from az_nic_id_get)</dt>
<dd>

</dd>
</dl>

<h2 id="az_ipconfig_name_get">az_ipconfig_name_get</h2>

<pre><code>my $ipconfig_name = az_ipconfig_name_get(
    resource_group =&gt; &#39;openqa-rg&#39;,
    name =&gt; &#39;openqa-vm&#39;)</code></pre>

<p>Get the name of the first IpConfig of a NIC from a NIC ID</p>

<dl>

<dt id="nic_id---existing-NIC-ID-eg.-from-az_nic_id_get2"><b>nic_id</b> - existing NIC ID (eg. from az_nic_id_get)</dt>
<dd>

</dd>
</dl>

<h2 id="az_ipconfig_update">az_ipconfig_update</h2>

<pre><code>az_ipconfig_update(
    resource_group =&gt; &#39;openqa-rg&#39;,
    ipconfig_name =&gt; &#39;openqa-ipconfig&#39;,
    nic_name =&gt; &#39;openqa-nic&#39;,
    ip =&gt; &#39;192.168.0.42&#39;)</code></pre>

<p>Change the IpConfig to use a static IP</p>

<dl>

<dt id="resource_group---existing-resource-group"><b>resource_group</b> - existing resource group</dt>
<dd>

</dd>
<dt id="ipconfig_name---existing-IP-configuration-NAME-eg.-from-az_ipconfig_name_get"><b>ipconfig_name</b> - existing IP configuration NAME (eg. from az_ipconfig_name_get)</dt>
<dd>

</dd>
<dt id="nic_name---existing-NIC-NAME-eg.-from-az_nic_name_get"><b>nic_name</b> - existing NIC NAME (eg. from az_nic_name_get)</dt>
<dd>

</dd>
<dt id="ip---IPv4-address-to-assign-as-static-IP"><b>ip</b> - IPv4 address to assign as static IP</dt>
<dd>

</dd>
</dl>

<h2 id="az_ipconfig_pool_add">az_ipconfig_pool_add</h2>

<pre><code>az_ipconfig_pool_add(
    resource_group =&gt; &#39;openqa-rg&#39;,
    lb_name =&gt; &#39;openqa-lb&#39;,
    address_pool =&gt; &#39;openqa-addr-pool&#39;,
    ipconfig_name =&gt; &#39;openqa-ipconfig&#39;,
    nic_name =&gt; &#39;openqa-nic&#39;)</code></pre>

<p>Add the IpConfig to a LB address pool</p>

<dl>

<dt id="resource_group---existing-resource-group1"><b>resource_group</b> - existing resource group</dt>
<dd>

</dd>
<dt id="lb_name---existing-Load-balancer-NAME"><b>lb_name</b> - existing Load balancer NAME</dt>
<dd>

</dd>
<dt id="address_pool---existing-Load-balancer-address-pool-name"><b>address_pool</b> - existing Load balancer address pool name</dt>
<dd>

</dd>
</dl>


</body>

</html>


